define("qtype_programming/submission",["jquery"],(function($){return{init:function(params){var attemptCount=0,waitForElement=setInterval((function(){attemptCount++;var inputEl=document.getElementById(params.inputId);if(inputEl){var handleSubmissionResult=function(res){var _res$time,_res$memory,_res$cases,explanation;switch(res.result){case"AC":explanation="<span style='color:green; font-weight:bold;'>‚úÖ Accepted</span>";break;case"WA":explanation="<span style='color:red; font-weight:bold;'>‚ùå Wrong Answer</span>";break;case"TLE":explanation="<span style='color:orange; font-weight:bold;'>‚è±Ô∏è Time Limit Exceeded</span>";break;case"MLE":explanation="<span style='color:purple; font-weight:bold;'>üíæ Memory Limit Exceeded</span>";break;case"RE":explanation="<span style='color:brown; font-weight:bold;'>üí• Runtime Error</span>";break;case"CE":explanation="<span style='color:gray; font-weight:bold;'>‚öôÔ∏è Compilation Error</span>";break;default:explanation="<span style='color:red;'>‚ùå Unknown result: "+(res.result||"N/A")+"</span>"}if(resultDiv.append("<br><strong>Language:</strong> "+res.language+"<br><strong>Time:</strong> "+(null!==(_res$time=res.time)&&void 0!==_res$time?_res$time:"-")+"<br><strong>Memory:</strong> "+(null!==(_res$memory=res.memory)&&void 0!==_res$memory?_res$memory:"-")+"<br>"+explanation),(null===(_res$cases=res.cases)||void 0===_res$cases?void 0:_res$cases.length)>0){var _res$case_points,_res$case_total,caseDetails='<br><br><strong>Test Cases:</strong><ul style="padding-left: 1.5em;">';res.cases.forEach((function(c){var _c$time,_c$memory,symbol="AC"===c.status?"‚úÖ":"‚ùå",points=void 0!==c.points&&void 0!==c.total?"".concat(c.points," / ").concat(c.total," points"):"no score",time=null!==(_c$time=c.time)&&void 0!==_c$time?_c$time:"-",memory=null!==(_c$memory=c.memory)&&void 0!==_c$memory?_c$memory:"-";caseDetails+="\n                                    <li>\n                                        ".concat(symbol," Case ").concat(c.case_id,": ").concat(points,'\n                                        <span style="font-size: 90%; color: #666;">\n                                            (Time: ').concat(time,"s, Mem: ").concat(memory," KB)\n                                        </span>\n                                    </li>")})),caseDetails+="</ul>";var totalPoints=null!==(_res$case_points=res.case_points)&&void 0!==_res$case_points?_res$case_points:0,totalTotal=null!==(_res$case_total=res.case_total)&&void 0!==_res$case_total?_res$case_total:0;resultDiv.append("\n                                <br><strong>Total:</strong> ".concat(totalPoints," / ").concat(totalTotal," points\n                                ").concat(caseDetails,"\n                            "))}},pollSubmission=function pollSubmission(submissionId){var tries=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;fetch(params.resultUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({submission_id:submissionId})}).then((function(res){return res.json()})).then((function(res){"unknown"===res.result||"P"===res.status?tries<10?setTimeout((function(){return pollSubmission(submissionId,tries+1)}),3e3):resultDiv.append('<br><span style="color:red;">‚ùå Still no result after waiting</span>'):handleSubmissionResult(res)})).catch((function(err){resultDiv.append('<br><span style="color:red;">‚ùå Error polling: '+err.message+"</span>")}))};clearInterval(waitForElement);var editor=window["codemirrorEditor_"+params.inputId]||{getValue:function(){return inputEl.value}};$("#"+params.submitButtonId).on("click",(function(){editor&&"function"==typeof editor.save&&editor.save();var code=inputEl.value,languageId=parseInt($("#"+params.selectId).val(),10);resultDiv=$("#"+params.resultContainerId),resultDiv.html("Submitting..."),fetch(params.submitUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:code,problemcode:params.problemCode,language:languageId,sesskey:params.sesskey,questionid:params.questionId,attemptid:params.attemptid})}).then((function(response){return response.json()})).then((function(data){if(!data.submission_id)throw new Error(data.error||"Unknown error");resultDiv.html("<strong>Submission ID:</strong> "+data.submission_id+"<br>Checking result...");var hiddenField=document.querySelector('input[name="'+params.submissionIdName+'"]');hiddenField&&(hiddenField.value=data.submission_id);var answerField=document.querySelector('textarea[name="'+params.inputname+'"]');answerField&&(answerField.value=answerField.value.trim()+" // submission #"+data.submission_id),pollSubmission(data.submission_id)})).catch((function(err){resultDiv.html('<span style="color:red;">Submission failed: '+err+"</span>")}))})),$("#"+params.showSubmissionsButtonId).on("click",(function(){var listDiv=$("#"+params.submissionListContainerId),button=$(this);if(listDiv.is(":empty")){listDiv.html('<span style="color:blue;">‚è≥ Loading submissions...</span>');var url=new URL(params.submissionListUrl);url.searchParams.append("questionid",params.questionId),url.searchParams.append("sesskey",params.sesskey),url.searchParams.append("attemptid",params.attemptid),fetch(url.toString(),{method:"GET",headers:{Accept:"application/json"}}).then((function(res){return res.json()})).then((function(data){if(data.submissions&&Array.isArray(data.submissions))if(0!==data.submissions.length){var html='<h4>Your Submissions</h4><ul style="padding-left:1.2em;">';data.submissions.forEach((function(sub){var _sub$source_code,_sub$language,_sub$time,_sub$memory,safeSource=$("<div>").text(null!==(_sub$source_code=sub.source_code)&&void 0!==_sub$source_code?_sub$source_code:"").html();html+='\n                                    <li style="margin-bottom: 1em;">\n                                        <div>\n                                            <strong>Status:</strong> '.concat(sub.status," |\n                                            <strong>Lang:</strong> ").concat(null!==(_sub$language=sub.language)&&void 0!==_sub$language?_sub$language:"-"," |\n                                            <strong>Time:</strong> ").concat(null!==(_sub$time=sub.time)&&void 0!==_sub$time?_sub$time:"-"," |\n                                            <strong>Memory:</strong> ").concat(null!==(_sub$memory=sub.memory)&&void 0!==_sub$memory?_sub$memory:"-",'\n                                            <button type="button" class="toggle-source" data-id="').concat(sub.submission_id,'">show code</button>\n                                        </div>\n                                        <pre id="source-').concat(sub.submission_id,'" class="submission-source" style="display:none;">').concat(safeSource,"</pre>\n                                    </li>")})),html+="</ul>",listDiv.html(html)}else listDiv.html('<span style="color:gray;">No submissions yet.</span>');else listDiv.html('<span style="color:red;">‚ùå Failed to load submissions</span>')})).catch((function(err){listDiv.html('<span style="color:red;">‚ùå Error fetching submissions: '+err.message+"</span>")})),button.text("Hide Submissions")}else listDiv.empty(),button.text("Show Submissions")})),window.toggleSourceInitialized||($(document).on("click",".toggle-source",(function(){var id=$(this).data("id");$("#source-"+id).slideToggle(200);var btn=$(this);btn.text("show code"===btn.text()?"Hide code":"show code")})),window.toggleSourceInitialized=!0)}else attemptCount>=30&&clearInterval(waitForElement)}),200)}}}));

//# sourceMappingURL=submission.min.js.map