{"version":3,"file":"edit_form.min.js","sources":["../src/edit_form.js"],"sourcesContent":["/* eslint-disable no-console */\n/* global tinyMCE, Y */\n\ndefine(['core/ajax', 'core/str', 'core/config'], function(Ajax, Str, Config) {\n\n    return {\n        init: function() {\n            document.addEventListener('DOMContentLoaded', function() {\n                const select = document.querySelector('[name=\"problemlist\"]');\n                const nameField = document.querySelector('[name=\"name\"]');\n                const codeField = document.querySelector('[name=\"problemcode\"]');\n                const nameFieldWrapper = document.querySelector('[id^=\"fitem_id_name\"]');\n                const problemIdField = document.querySelector('[name=\"problemid\"]');\n                const editorId = 'id_questiontext';\n\n                if (nameFieldWrapper) {\n                    nameFieldWrapper.style.display = 'none';\n                }\n\n                // Fetch the list of available problems\n                fetch(Config.wwwroot + '/question/type/programming/fetchproblems.php')\n                    .then(response => response.json())\n                    .then(data => {\n                        data.forEach(problem => {\n                            const option = document.createElement('option');\n                            option.value = problem.code;\n                            option.textContent = problem.name;\n                            select.appendChild(option);\n                        });\n                    });\n\n                // On selection change, fetch problem info and update fields\n                select.addEventListener('change', function() {\n                    const code = this.value;\n                    codeField.value = code;\n\n                    fetch(Config.wwwroot + '/question/type/programming/fetchproblem.php?code=' + encodeURIComponent(code))\n                        .then(response => response.json())\n                        .then(data => {\n                            if (nameField) {\n                                nameField.value = data.name || '';\n                            }\n                            if (codeField) {\n                                codeField.value = data.code || '';\n                            }\n                            if (problemIdField) {\n                                problemIdField.value = data.id || '';\n                            }\n\n                            const description = data.description || '';\n\n                            // TinyMCE\n                            if (typeof tinyMCE !== 'undefined' && tinyMCE.get(editorId)) {\n                                tinyMCE.get(editorId).setContent(description);\n                            }\n\n                            // Atto\n                            if (typeof Y !== 'undefined' && Y.one('#' + editorId + '_editable')) {\n                                Y.one('#' + editorId + '_editable').setHTML(description);\n                            }\n\n                            // Fallback (raw textarea)\n                            const rawTextarea = document.getElementById(editorId);\n                            if (rawTextarea) {\n                                rawTextarea.value = description;\n                            }\n                        });\n                });\n            });\n        }\n    };\n});\n"],"names":["define","Ajax","Str","Config","init","document","addEventListener","select","querySelector","nameField","codeField","nameFieldWrapper","problemIdField","editorId","style","display","fetch","wwwroot","then","response","json","data","forEach","problem","option","createElement","value","code","textContent","name","appendChild","this","encodeURIComponent","id","description","tinyMCE","get","setContent","Y","one","setHTML","rawTextarea","getElementById"],"mappings":"AAGAA,qCAAO,CAAC,YAAa,WAAY,gBAAgB,SAASC,KAAMC,IAAKC,cAE1D,CACHC,KAAM,WACFC,SAASC,iBAAiB,oBAAoB,eACpCC,OAASF,SAASG,cAAc,wBAChCC,UAAYJ,SAASG,cAAc,iBACnCE,UAAYL,SAASG,cAAc,wBACnCG,iBAAmBN,SAASG,cAAc,yBAC1CI,eAAiBP,SAASG,cAAc,sBACxCK,SAAW,kBAEbF,mBACAA,iBAAiBG,MAAMC,QAAU,QAIrCC,MAAMb,OAAOc,QAAU,gDAClBC,MAAK,SAAAC,iBAAYA,SAASC,UAC1BF,MAAK,SAAAG,MACFA,KAAKC,SAAQ,SAAAC,aACHC,OAASnB,SAASoB,cAAc,UACtCD,OAAOE,MAAQH,QAAQI,KACvBH,OAAOI,YAAcL,QAAQM,KAC7BtB,OAAOuB,YAAYN,cAK/BjB,OAAOD,iBAAiB,UAAU,eACxBqB,KAAOI,KAAKL,MAClBhB,UAAUgB,MAAQC,KAElBX,MAAMb,OAAOc,QAAU,oDAAsDe,mBAAmBL,OAC3FT,MAAK,SAAAC,iBAAYA,SAASC,UAC1BF,MAAK,SAAAG,MACEZ,YACAA,UAAUiB,MAAQL,KAAKQ,MAAQ,IAE/BnB,YACAA,UAAUgB,MAAQL,KAAKM,MAAQ,IAE/Bf,iBACAA,eAAec,MAAQL,KAAKY,IAAM,QAGhCC,YAAcb,KAAKa,aAAe,GAGjB,oBAAZC,SAA2BA,QAAQC,IAAIvB,WAC9CsB,QAAQC,IAAIvB,UAAUwB,WAAWH,aAIpB,oBAANI,GAAqBA,EAAEC,IAAI,IAAM1B,SAAW,cACnDyB,EAAEC,IAAI,IAAM1B,SAAW,aAAa2B,QAAQN,iBAI1CO,YAAcpC,SAASqC,eAAe7B,UACxC4B,cACAA,YAAYf,MAAQQ"}