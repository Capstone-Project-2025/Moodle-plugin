<?xml version="1.0" encoding="UTF-8" ?>
<XMLDB PATH="question/type/programming/db" VERSION="2025042901" COMMENT="Install XML for programming question type">
    <TABLES>

        <!-- Programming languages table -->
        <TABLE NAME="programming_language" COMMENT="Available programming languages">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="name" TYPE="text" NOTNULL="true"/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
            </KEYS>
        </TABLE>

        <!-- Programming problems table -->
        <TABLE NAME="programming_problem" COMMENT="Programming problems created by users">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="code" TYPE="char" LENGTH="100" NOTNULL="true"/>
                <FIELD NAME="name" TYPE="text" NOTNULL="true"/>
                <FIELD NAME="description" TYPE="text" NOTNULL="false"/>
                <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true"/>
                <FIELD NAME="ispublic" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0"/>
                <FIELD NAME="points" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0"/>
                <FIELD NAME="difficulty" TYPE="char" LENGTH="10" NOTNULL="false"/>
                <FIELD NAME="time_limit" TYPE="float" LENGTH="10,2" NOTNULL="true" DEFAULT="1.00" COMMENT="Time limit in seconds"/>
                <FIELD NAME="memory_limit" TYPE="float" LENGTH="10,2" NOTNULL="true" DEFAULT="64.00" COMMENT="Memory limit in MB"/>

            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
                <KEY NAME="uniq_code" TYPE="unique" FIELDS="code"/>
                <KEY NAME="fk_user" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
            </KEYS>
        </TABLE>

        <!-- Problem-language relation table (many-to-many) -->
        <TABLE NAME="programming_problem_language" COMMENT="Link between problems and supported languages">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="problem_id" TYPE="int" LENGTH="10" NOTNULL="true"/>
                <FIELD NAME="language_id" TYPE="int" LENGTH="10" NOTNULL="true"/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
                <KEY NAME="uniq_pair" TYPE="unique" FIELDS="problem_id,language_id"/>
                <KEY NAME="fk_problem" TYPE="foreign" FIELDS="problem_id" REFTABLE="programming_problem" REFFIELDS="id"/>
                <KEY NAME="fk_language" TYPE="foreign" FIELDS="language_id" REFTABLE="programming_language" REFFIELDS="id"/>
            </KEYS>
        </TABLE>

        <!-- Problem types table -->
        <TABLE NAME="programming_type" COMMENT="List of programming problem types">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="name" TYPE="text" NOTNULL="true"/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
            </KEYS>
        </TABLE>

        <!-- Problem <-> Type relationship table -->
        <TABLE NAME="programming_problem_type" COMMENT="Link between problems and types">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="problem_id" TYPE="int" LENGTH="10" NOTNULL="true"/>
                <FIELD NAME="type_id" TYPE="int" LENGTH="10" NOTNULL="true"/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
                <KEY NAME="uniq_pair" TYPE="unique" FIELDS="problem_id,type_id"/>
                <KEY NAME="fk_problem" TYPE="foreign" FIELDS="problem_id" REFTABLE="programming_problem" REFFIELDS="id"/>
                <KEY NAME="fk_type" TYPE="foreign" FIELDS="type_id" REFTABLE="programming_type" REFFIELDS="id"/>
            </KEYS>
        </TABLE>

        <!-- Test cases table -->
        <TABLE NAME="programming_testcase" COMMENT="Test cases for programming problems">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="problem_id" TYPE="int" LENGTH="10" NOTNULL="true"/>
                <FIELD NAME="points" TYPE="int" LENGTH="10" NOTNULL="true" DEFAULT="0"/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
                <KEY NAME="fk_problem" TYPE="foreign" FIELDS="problem_id" REFTABLE="programming_problem" REFFIELDS="id"/>
            </KEYS>
        </TABLE>



        <TABLE NAME="qtype_programming_options" COMMENT="Options for programming questions.">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="questionid" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="ID of the question"/>
                <FIELD NAME="problem_id" TYPE="int" LENGTH="10" NOTNULL="true"/>

            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
                <KEY NAME="questionidfk" TYPE="foreign" FIELDS="questionid" REFTABLE="question" REFFIELDS="id"/>
                <KEY NAME="problemidfk" TYPE="foreign" FIELDS="problem_id" REFTABLE="programming_problem" REFFIELDS="id"/>
            </KEYS>
        </TABLE>

<TABLE NAME="qtype_programming_submission" COMMENT="Stores external submission references for programming questions.">
    <FIELDS>
        <FIELD NAME="submission_id" TYPE="int" LENGTH="10" NOTNULL="true"/>
        <FIELD NAME="question_id" TYPE="int" LENGTH="10" NOTNULL="true"/>
        <FIELD NAME="user_id" TYPE="int" LENGTH="10" NOTNULL="true"/>
        <FIELD NAME="result" TYPE="char" LENGTH="30" NOTNULL="true"/>
        <FIELD NAME="point" TYPE="float" LENGTH="10" NOTNULL="true"/>
        <FIELD NAME="total_point" TYPE="float" LENGTH="10" NOTNULL="true"/>
        <FIELD NAME="language_id" TYPE="int" LENGTH="10" NOTNULL="true"/>
        <FIELD NAME="course_id" TYPE="int" LENGTH="10" NOTNULL="true"/>
        <FIELD NAME="attempt_id" TYPE="int" LENGTH="10" NOTNULL="true"/>
        <FIELD NAME="code" TYPE="text" NOTNULL="true"/>
    </FIELDS>
    <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="submission_id"/>
        <KEY NAME="questionfk" TYPE="foreign" FIELDS="question_id" REFTABLE="qtype_programmingramming_options" REFFIELDS="id"/>
        <KEY NAME="languagefk" TYPE="foreign" FIELDS="language_id" REFTABLE="programming_language" REFFIELDS="id"/>
        <KEY NAME="userfk" TYPE="foreign" FIELDS="user_id" REFTABLE="user" REFFIELDS="id"/>
    </KEYS>
</TABLE>

    </TABLES>
</XMLDB>
